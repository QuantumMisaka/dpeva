# 研判结论与开发计划

基于代码现状和“Python之禅”的指导思想，我建议采用 **方案二：全面采用 "auto" 模式，并移除 `DEFAULT_DATA_FORMAT` 及相关配置入口**。

### 核心理由 (Why Option 2?)

1.  **鲁棒性验证**: 经过严格测试，`load_systems(fmt="auto")` 已被证明能完美兼容 Mixed 和 NPY 格式，且能自动修复原子名称重复等常见问题。其实际表现优于手动指定。
2.  **极简主义**: 既然 "auto" 总是对的，那么暴露配置项只会增加用户的认知负担和配置文件的复杂度。
3.  **一致性**: 目前 `InferenceWorkflow` 和 `CollectionWorkflow` 已经隐式使用了 `auto` 且未暴露配置。移除 `FeatureWorkflow` 的配置入口将使所有模块在数据加载行为上达成完美一致。
4.  **无损兼容**: `BaseWorkflowConfig` 已配置 `extra='ignore'`，这意味着旧的配置文件即使包含 `"format": "..."` 字段，也只会被静默忽略而不会报错，从而保障了向后兼容性。

### 实施计划

我将执行以下开发步骤来实现这一方案：

#### 1. 代码清理 (Refactoring)
*   **`src/dpeva/constants.py`**: 删除 `DEFAULT_DATA_FORMAT` 常量定义。
*   **`src/dpeva/config.py`**: 从 `FeatureConfig` 类中删除 `data_format` 字段及其别名 `format`。
*   **`src/dpeva/workflows/feature.py`**: 更新 `FeatureWorkflow`，移除对 `self.config.data_format` 的引用，在调用生成器时直接传递 `fmt="auto"` 或移除该参数（如果生成器默认值已更新）。
*   **`src/dpeva/feature/generator.py`**: 更新 `DescriptorGenerator.run_python_generation` 和 `compute_descriptors_python` 方法，将 `data_format` 参数的默认值设为 `"auto"`（或移除该参数，视内部调用需求而定，建议保留参数但默认为 auto 以供库调用者使用）。

#### 2. 验证 (Verification)
*   **单元测试**: 运行 `tests/unit/workflows/test_feature_workflow_env.py`，确保在移除配置字段后，工作流仍能正常初始化并运行（可能需要调整测试用例中对 `format` 字段的断言）。
*   **集成验证**: 再次运行 `verify_consistency.py` (如果还在) 或手动触发一次小规模测试，确保修改后的代码在 Mixed 和 NPY 数据上依然表现一致。

#### 3. 文档更新 (Documentation)
*   **开发者指南**: 更新 `DP-EVA_Project_Developer_Guide.md`，说明数据加载已统一为自动检测，不再需要用户配置格式。
